## 一.pushGateway搭建

```bash
一.搭建pushgateway
docker pull prom/pushgateway
docker run -d --name=pg -p 9091:9091 prom/pushgateway
  或者
 docker run -d   --name=pg10  -p 9091:9091 prom/pushgateway  "--persistence.file=pushgateway.data  --persistence.interval=3" 持久化保存数据
 #访问方式:
 http://xxx.195.185.78:9091/#
二.配置prometheus
2.1修改配置
- job_name: pushgateway
      static_configs:
        - target: ['10.206.16.14:9091']
          label:
            instance: pushgateway
 2.2 使配置生效(使用k8s搭建)           
 kubectl  apply -f prometheus-configmap.yaml 
 curl -X POST 10.1.192.105:9090/-/reload
 2.3 查看是否在prometheus生效
 http://xxx.195.185.78:30089/targets
 #参考资料
 https://www.cnblogs.com/xiao987334176/p/9933963.html
 https://songjiayang.gitbooks.io/prometheus/content/pushgateway/how.html
```

## 二.shell数据管理

### 2.1操作

```bash
#2.1 shell形式添加数据,主要是添加一个job
echo "some_metric 3.14" | curl --data-binary @- http://127.0.0.1:9091/metrics/job/test_job
#2.2在某一个job下添加instance
cat <<EOF | curl --data-binary @- http://127.0.0.1:9091/metrics/job/test_job/instance/some_instance # TYPE some_metric counter
some_metric{label="val1"} 999
# TYPE another_metric gauge
# HELP another_metric Just an example.
another_metric 2398.283
EOF
#2.3常用操作
#删除某个组下的所有数据
curl -X DELETE http://127.0.0.1:9091/metrics/job/test_job
#删除某个组下某个实例的所有数据：
 curl -X DELETE http://127.0.0.1:9091/metrics/job/test_job/instance/some_instance
```

### 2.2结果

![image-20220307160235020](C:\Users\maowan\AppData\Roaming\Typora\typora-user-images\image-20220307160235020.png)

## 三. python数据管理

```bash
#1.提前安装py模块
pip install flask
pip install prometheus_client
```



